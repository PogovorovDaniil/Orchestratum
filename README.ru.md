# Orchestratum

[![NuGet](https://img.shields.io/nuget/v/Orchestratum.svg)](https://www.nuget.org/packages/Orchestratum/)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE.txt)

–õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –¥–ª—è .NET –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫, —Ç–∞–π–º–∞—É—Ç–∞–º–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Entity Framework Core.

## üì¶ –ü–∞–∫–µ—Ç—ã

| –ü–∞–∫–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | NuGet |
|-------|----------|-------|
| **Orchestratum** | –û—Å–Ω–æ–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ | [![NuGet](https://img.shields.io/nuget/v/Orchestratum.svg)](https://www.nuget.org/packages/Orchestratum/) |
| **Orchestratum.MediatR** | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MediatR | [![NuGet](https://img.shields.io/nuget/v/Orchestratum.MediatR.svg)](https://www.nuget.org/packages/Orchestratum.MediatR/) |

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á** - –ó–∞–¥–∞—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –ø–µ—Ä–µ–∂–∏–≤–∞—é—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã** - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –Ω–µ—É–¥–∞–≤—à–∏—Ö—Å—è –∑–∞–¥–∞—á
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞–º–∏** - –¢–∞–π–º–∞—É—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ multi-instance –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- **–ì–∏–±–∫–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏** - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á
- **–§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ hosted service
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å EF Core** - –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–π EF Core

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
dotnet add package Orchestratum
# –ò–ª–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π MediatR
dotnet add package Orchestratum.MediatR
```

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–±–µ–∑ MediatR)

```csharp
// 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
services.AddOchestrator((sp, opts) =>
{
    opts.ConfigureDbContext(dbOpts => 
        dbOpts.UseNpgsql("Host=localhost;Database=myapp"));

    opts.RegisterExecutor("send-email", async (serviceProvider, data, cancellationToken) =>
    {
        var emailService = serviceProvider.GetRequiredService<IEmailService>();
        var emailData = (EmailData)data;
        await emailService.SendAsync(emailData, cancellationToken);
    });

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    opts.DefaultTimeout = TimeSpan.FromMinutes(5);
    opts.DefaultRetryCount = 3;
    opts.CommandPollingInterval = TimeSpan.FromSeconds(30);
});

// 2. –ò–Ω—ä–µ–∫—Ü–∏—è IOrchestrator –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥—å
public class MyService
{
    private readonly IOrchestrator _orchestrator;

    public MyService(IOrchestrator orchestrator)
    {
        _orchestrator = orchestrator;
    }

    public async Task SendEmail(string to, string subject, string body)
    {
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        await _orchestrator.Append("send-email", new EmailData 
        { 
            To = to, 
            Subject = subject, 
            Body = body 
        });

        // –ò–ª–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ç–∞–π–º–∞—É—Ç–∞ –∏ –ø–æ–≤—Ç–æ—Ä–æ–≤
        await _orchestrator.Append(
            "send-email", 
            new EmailData { To = to, Subject = subject, Body = body },
            timeout: TimeSpan.FromMinutes(10),
            retryCount: 5
        );
    }
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å MediatR

```csharp
// 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
services.AddMediatR(opts => 
    opts.RegisterServicesFromAssembly(typeof(Program).Assembly));

services.AddOchestrator((sp, opts) =>
{
    opts.ConfigureDbContext(dbOpts => dbOpts.UseNpgsql("Host=localhost;Database=myapp"));
    opts.RegisterMediatR();  // –í–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å MediatR
});

// 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ MediatR –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
public record SendEmailCommand(string To, string Subject, string Body) : IRequest;

public class SendEmailHandler : IRequestHandler<SendEmailCommand>
{
    private readonly IEmailService _emailService;

    public SendEmailHandler(IEmailService emailService)
    {
        _emailService = emailService;
    }

    public async Task Handle(SendEmailCommand request, CancellationToken cancellationToken)
    {
        await _emailService.SendAsync(request.To, request.Subject, request.Body, cancellationToken);
    }
}

// 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ MediatR –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ—á–µ—Ä–µ–¥—å
public class MyService
{
    private readonly IOrchestrator _orchestrator;

    public MyService(IOrchestrator orchestrator)
    {
        _orchestrator = orchestrator;
    }

    public void SendEmail(string to, string subject, string body)
    {
        // –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ MediatR –∑–∞–ø—Ä–æ—Å
        _orchestrator.Append(new SendEmailCommand(to, subject, body));

        // –ò–ª–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        _orchestrator.Append(
            new SendEmailCommand(to, subject, body),
            timeout: TimeSpan.FromMinutes(10),
            retryCount: 5
        );
    }
}
```

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –∑–¥–µ—Å—å:
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Orchestratum Core](src/Orchestratum/README.ru.md)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Orchestratum.MediatR](src/Orchestratum.MediatR/README.ru.md)

## üåê –Ø–∑—ã–∫–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏

- [English](README.md)
- [–†—É—Å—Å–∫–∏–π](README.ru.md)

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT - –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ —Ñ–∞–π–ª–µ [LICENSE.txt](LICENSE.txt).

## üîó –°—Å—ã–ª–∫–∏

- [GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π](https://github.com/PogovorovDaniil/Orchestratum)
- [NuGet –ø–∞–∫–µ—Ç](https://www.nuget.org/packages/Orchestratum/)
